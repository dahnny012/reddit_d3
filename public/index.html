<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>


<script>

var COMMENT_REGEX = 't'
var MORE_REGEX = 'more'

// a convenience wrapper
function Thread(data){
  this.comments = data[1].data.children.map(function(e){
    return new Comment(e)
  })
}

// Edge case ill deal with later
function More(){
  // get request and stream
}

function Comment(raw){
  this.comment = raw.data
  this.body = this.comment.body
  if(this.comment.replies != "" && this.comment.replies != undefined){
    this.replies = this.comment.replies.data.children.map(function(e){
      return new build_strategy(e.kind)
    })
  }else{
    this.replies = null
  }

  function build_strategy(type){
    if(type.includes(COMMENT_REGEX))
      return Comment
    if(type.includes(MORE_REGEX))
      return More
  }
}

var thread;
var reddit_loaded = new CustomEvent('reddit_data');
bootstrap()

function bootstrap(){
  get_reddit_data()
  document.addEventListener('reddit_data', build_d3)
}

function get_reddit_data() {
  $.get('https://www.reddit.com/r/leagueoflegends/comments/5l724n/zven_on_twitter_adc_is_so_fucking_useless/.json').
  then(function(data, status){
    thread = new Thread(data);
    document.dispatchEvent(reddit_loaded);
  })
}

function build_d3(){
  console.log("building d3")
  // TODO build d3
}



</script>
